<div class="page-header">
    <h2>Nóminas y Pagos</h2>
    <button id="btn-nueva-nomina" class="btn btn-primary">+ Nueva Nómina</button>
</div>

<div class="page-content">
    <!-- Barra de búsqueda y filtros -->
    <div class="search-bar">
        <input type="text" id="search-nomina" placeholder="Buscar por empleado..." class="search-input">
        <select id="filter-empleado" class="filter-select">
            <option value="all">Todos los empleados</option>
        </select>
        <input type="date" id="filter-fecha" class="filter-select" style="max-width: 200px;">
    </div>

    <!-- Nóminas separadas por moneda -->
    <div id="nominas-container">
        <!-- Nóminas en Bolívares -->
        <div id="nominas-bs-section" style="margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px; color: var(--text-primary);">Nóminas Pagadas en Bolívares</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Empleado</th>
                            <th>Fecha de Pago</th>
                            <th>Comisiones (Bs)</th>
                            <th>Propinas (Bs)</th>
                            <th>Descuentos (Bs)</th>
                            <th>Total Pagado (Bs)</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="nominas-table-body-bs">
                        <tr>
                            <td colspan="9" class="loading">Cargando nóminas...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="pagination-bs" class="pagination"></div>
        </div>

        <!-- Nóminas en Dólares -->
        <div id="nominas-dolares-section" style="margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px; color: var(--text-primary);">Nóminas Pagadas en Dólares</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Empleado</th>
                            <th>Fecha de Pago</th>
                            <th>Comisiones Ref. ($)</th>
                            <th>Propinas Ref. ($)</th>
                            <th>Total Pagado ($)</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="nominas-table-body-dolares">
                        <tr>
                            <td colspan="8" class="loading">Cargando nóminas...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="pagination-dolares" class="pagination"></div>
        </div>

    </div>
</div>

<!-- Modal para crear/editar nómina -->
<div id="nomina-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="modal-title">Nueva Nómina</h3>
            <button class="modal-close" id="close-modal">&times;</button>
        </div>
        <form id="nomina-form">
            <input type="hidden" id="nomina-id">
            
            <div class="form-row">
                <div class="form-group">
                    <label for="nomina-empleado">Empleado *</label>
                    <select id="nomina-empleado" name="id_empleado" required>
                        <option value="">Seleccione un empleado...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nomina-fecha">Fecha de Pago *</label>
                    <input type="date" id="nomina-fecha" name="fecha_pago" required>
                </div>
            </div>

            <!-- Resumen de servicios realizados -->
            <div class="form-group">
                <label>Servicios Realizados</label>
                <div id="servicios-resumen" style="background: var(--bg-secondary); padding: 15px; border-radius: 6px; margin-bottom: 15px; max-height: 200px; overflow-y: auto;">
                    <p style="color: var(--text-secondary);">Seleccione un empleado y fecha para ver los servicios</p>
                </div>
            </div>

            <!-- Resumen de consumos pendientes -->
            <div class="form-group">
                <label>Consumos Pendientes</label>
                <div id="consumos-resumen" style="background: var(--bg-secondary); padding: 15px; border-radius: 6px; margin-bottom: 15px; max-height: 200px; overflow-y: auto;">
                    <p style="color: var(--text-secondary);">Seleccione un empleado y fecha para ver los consumos</p>
                </div>
            </div>

            <!-- Totales calculados -->
            <div class="form-row">
                <div class="form-group campo-dolares" style="flex: 1;">
                    <label>Comisiones Ref. ($)</label>
                    <input type="text" id="nomina-comisiones-dolares" name="comisiones_dolares" placeholder="0.00" readonly>
                </div>
                <div class="form-group campo-bolivares" style="flex: 1;">
                    <label>Comisiones (Bs)</label>
                    <input type="text" id="nomina-comisiones-bs" name="comisiones_bs" placeholder="0.00" readonly>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group campo-dolares" style="flex: 1;">
                    <label>Propinas Ref. ($)</label>
                    <input type="text" id="nomina-propinas-dolares" name="propinas_dolares" placeholder="0.00" readonly>
                </div>
                <div class="form-group campo-bolivares" style="flex: 1;">
                    <label>Propinas (Bs)</label>
                    <input type="text" id="nomina-propinas-bs" name="propinas_bs" placeholder="0.00" readonly>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group campo-bolivares" style="flex: 1;">
                    <label>Descuentos Consumos (Bs)</label>
                    <input type="text" id="nomina-descuentos" name="descuentos" placeholder="0.00" readonly>
                </div>
                <div class="form-group campo-bolivares" style="flex: 1;">
                    <label>Subtotal (Bs)</label>
                    <input type="text" id="nomina-subtotal" name="subtotal" placeholder="0.00" readonly>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label>Porcentaje a Pagar: <span id="nomina-porcentaje-valor">60</span>%</label>
                    <input type="text" id="nomina-porcentaje" name="porcentaje" value="60" readonly style="background: var(--bg-secondary);">
                </div>
                <div class="form-group campo-bolivares" style="flex: 1;">
                    <label>Total a Pagar (Bs) *</label>
                    <input type="text" id="nomina-total" name="total_pagado" placeholder="0.00" readonly style="font-size: 18px; font-weight: 600;">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group campo-dolares" style="flex: 1;">
                    <label>Total a Pagar ($) *</label>
                    <input type="text" id="nomina-total-dolares" name="total_pagado_dolares" placeholder="0.00" readonly style="font-size: 18px; font-weight: 600;">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Moneda de Pago *</label>
                    <select id="nomina-moneda-pago" name="moneda_pago" required>
                        <option value="bs">Bolívares (Bs)</option>
                        <option value="dolares">Dólares ($)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label>Estado de Pago</label>
                    <select id="nomina-estado-pago" name="estado_pago" required>
                        <option value="pendiente">Pendiente</option>
                        <option value="pagado">Pagado</option>
                    </select>
                </div>
            </div>


            <div class="info-box">
                <p><strong>Nota:</strong> Los valores se calculan automáticamente según los servicios realizados y consumos pendientes del empleado. Las nóminas incluyen todo lo pendiente de días anteriores. El porcentaje a pagar es siempre 60% fijo. Las propinas NO se descuentan del total final.</p>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-nomina">Cancelar</button>
                <button type="button" class="btn btn-primary" id="guardar-nomina">Guardar Nómina</button>
                <button type="button" class="btn btn-success" id="pagar-nomina" style="display: none;">Marcar como Pagado</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para ver detalles de nómina -->
<div id="ver-nomina-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="ver-nomina-titulo">Detalles de la Nómina</h3>
            <button class="modal-close" id="close-ver-nomina-modal">&times;</button>
        </div>
        <div id="ver-nomina-contenido" style="padding: 20px; max-height: 70vh; overflow-y: auto;">
            <!-- El contenido se llenará dinámicamente -->
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cerrar-ver-nomina">Cerrar</button>
        </div>
    </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div id="delete-modal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h3>Confirmar Eliminación</h3>
            <button class="modal-close" id="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p>¿Estás seguro de que deseas eliminar esta nómina?</p>
            <p class="warning-text">Esta acción no se puede deshacer. Los consumos asociados volverán a estar pendientes.</p>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancel-delete">Cancelar</button>
            <button type="button" class="btn btn-danger" id="confirm-delete">Eliminar</button>
        </div>
    </div>
</div>

