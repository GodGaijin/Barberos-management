<div class="page-header">
    <h2>Transacciones</h2>
    <button id="btn-nueva-transaccion" class="btn btn-primary">+ Nueva Transacci칩n</button>
</div>

<div class="page-content">
    <!-- Barra de b칰squeda y filtros -->
    <div class="search-bar">
        <input type="text" id="search-transaccion" placeholder="Buscar por cliente..." class="search-input">
        <select id="filter-estado" class="filter-select">
            <option value="all">Todas las transacciones</option>
            <option value="abierta">Abiertas</option>
            <option value="cerrada">Cerradas</option>
        </select>
    </div>
    
    <!-- Filtros de fecha -->
    <div class="date-filters" style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
        <button type="button" class="btn btn-primary date-filter-btn active" data-filter="hoy">Hoy</button>
        <button type="button" class="btn btn-secondary date-filter-btn" data-filter="ayer">Ayer</button>
        <button type="button" class="btn btn-secondary date-filter-btn" data-filter="semana">Hace una Semana</button>
        <button type="button" class="btn btn-secondary date-filter-btn" data-filter="a침o">Hace un A침o</button>
        <button type="button" class="btn btn-secondary date-filter-btn" data-filter="todas">Todas</button>
    </div>

    <!-- Tabla de transacciones -->
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Cliente</th>
                    <th>Fecha Apertura</th>
                    <th>Fecha Cierre</th>
                    <th>Total (Bs)</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="transacciones-table-body">
                <tr>
                    <td colspan="7" class="loading">Cargando transacciones...</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="pagination-transacciones" class="pagination"></div>
</div>

<!-- Modal para nueva transacci칩n -->
<div id="transaccion-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="modal-title">Nueva Transacci칩n</h3>
            <button class="modal-close" id="close-modal">&times;</button>
        </div>
        <form id="transaccion-form">
            <input type="hidden" id="transaccion-id">
            
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label for="transaccion-cliente">Cliente *</label>
                    <div style="position: relative;">
                        <input type="text" id="transaccion-cliente-search" placeholder="Buscar cliente..." class="search-input" style="width: 100%; color: var(--text-primary); margin-bottom: 8px;">
                        <div id="clientes-results-dropdown" class="search-results-dropdown" style="display: none;"></div>
                    </div>
                    <button type="button" id="btn-buscar-cliente-db" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px; width: 100%;" title="Buscar en base de datos">游댌 Buscar en Base de Datos</button>
                    <select id="transaccion-cliente" name="id_cliente" required>
                        <option value="">Seleccione un cliente...</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 0 0 auto; align-self: flex-end;">
                    <button type="button" id="btn-nuevo-cliente-transaccion" class="btn btn-secondary" style="padding: 8px 16px;">+ Nuevo Cliente</button>
                </div>
            </div>

            <!-- Servicios -->
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="margin: 0;">Servicios</label>
                    <button type="button" id="btn-agregar-servicio" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">+ Agregar Servicio</button>
                </div>
                <div style="margin-bottom: 10px;">
                    <div style="position: relative;">
                        <input type="text" id="transaccion-servicio-search" placeholder="Buscar servicio..." class="search-input" style="width: 100%; color: var(--text-primary); margin-bottom: 8px;">
                        <div id="servicios-results-dropdown" class="search-results-dropdown" style="display: none;"></div>
                    </div>
                    <button type="button" id="btn-buscar-servicio-db" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px; width: 100%;" title="Buscar en base de datos">游댌 Buscar en Base de Datos</button>
                </div>
                <div id="servicios-lista" style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Los servicios se agregar치n aqu칤 din치micamente -->
                </div>
            </div>

            <!-- Productos -->
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="margin: 0;">Productos</label>
                    <button type="button" id="btn-agregar-producto" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">+ Agregar Producto</button>
                </div>
                <div style="margin-bottom: 10px;">
                    <div style="position: relative;">
                        <input type="text" id="transaccion-producto-search" placeholder="Buscar producto..." class="search-input" style="width: 100%; color: var(--text-primary); margin-bottom: 8px;">
                        <div id="productos-results-dropdown" class="search-results-dropdown" style="display: none;"></div>
                    </div>
                    <button type="button" id="btn-buscar-producto-db" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px; width: 100%;" title="Buscar en base de datos">游댌 Buscar en Base de Datos</button>
                </div>
                <div id="productos-lista" style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Los productos se agregar치n aqu칤 din치micamente -->
                </div>
            </div>

            <!-- Propinas -->
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="margin: 0;">Propinas</label>
                    <button type="button" id="btn-agregar-propina" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">+ Agregar Propina</button>
                </div>
                <div id="propinas-lista" style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Las propinas se agregar치n aqu칤 din치micamente -->
                </div>
            </div>

            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label for="transaccion-total-general">Total General (Bs)</label>
                    <input type="text" id="transaccion-total-general" name="total_general" placeholder="0.00" inputmode="decimal" readonly style="font-size: 18px; font-weight: 600;">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="transaccion-total-general-dolares">Total General ($)</label>
                    <input type="text" id="transaccion-total-general-dolares" name="total_general_dolares" placeholder="0.00" inputmode="decimal" readonly style="font-size: 18px; font-weight: 600;">
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-transaccion">Cancelar</button>
                <button type="button" class="btn btn-primary" id="guardar-transaccion">Guardar Transacci칩n</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para cerrar transacci칩n -->
<div id="cerrar-transaccion-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Cerrar Transacci칩n</h3>
            <button class="modal-close" id="close-cerrar-modal">&times;</button>
        </div>
        <form id="cerrar-transaccion-form">
            <input type="hidden" id="cerrar-transaccion-id">
            
            <div class="form-group">
                <label>Resumen de la Transacci칩n</label>
                <div id="resumen-transaccion" style="background: var(--bg-secondary); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                    <!-- Resumen se llenar치 din치micamente -->
                </div>
            </div>

            <div class="form-group">
                <label>M칠todos de Pago *</label>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="metodo_pago" value="efectivo" class="metodo-pago-checkbox">
                        <span class="checkbox-label">Efectivo</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="metodo_pago" value="efectivo_divisa" class="metodo-pago-checkbox">
                        <span class="checkbox-label">Efectivo en Divisa</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="metodo_pago" value="transferencia" class="metodo-pago-checkbox" data-requiere-entidad="true">
                        <span class="checkbox-label">Transferencia</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="metodo_pago" value="divisa" class="metodo-pago-checkbox" data-requiere-entidad="true">
                        <span class="checkbox-label">Divisa</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="metodo_pago" value="punto_venta" class="metodo-pago-checkbox">
                        <span class="checkbox-label">Punto de Venta</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="metodo_pago" value="pago_movil" class="metodo-pago-checkbox" data-requiere-entidad="true">
                        <span class="checkbox-label">Pago M칩vil</span>
                    </label>
                </div>
            </div>

            <div class="form-group" id="entidades-group" style="display: none;">
                <label>Entidades de Pago *</label>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="entidad_pago" value="Banco Nacional de Credito" class="entidad-pago-checkbox">
                        <span class="checkbox-label">Banco Nacional de Cr칠dito</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="entidad_pago" value="Banesco" class="entidad-pago-checkbox">
                        <span class="checkbox-label">Banesco</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="entidad_pago" value="Binance" class="entidad-pago-checkbox">
                        <span class="checkbox-label">Binance</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="entidad_pago" value="Banco de Venezuela" class="entidad-pago-checkbox">
                        <span class="checkbox-label">Banco de Venezuela</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="entidad_pago" value="Zelle" class="entidad-pago-checkbox">
                        <span class="checkbox-label">Zelle</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="numero-referencia">N칰mero(s) de Referencia</label>
                <input type="text" id="numero-referencia" name="numero_referencia" placeholder="Ej: 123456, 789012 (separados por coma)">
                <small style="color: var(--text-secondary); font-size: 12px; margin-top: 5px; display: block;">Si hay m칰ltiples referencias, sep치ralas por coma</small>
            </div>

            <!-- Campos para cantidad pagada en bol칤vares y d칩lares -->
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label for="cerrar-pagado-bs">Cantidad Pagada (Bs)</label>
                    <input type="text" id="cerrar-pagado-bs" name="pagado_bs" placeholder="000.00" inputmode="decimal" style="text-align: right; direction: rtl;">
                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 5px;">Formato autom치tico de derecha a izquierda</small>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="cerrar-pagado-dolares">Cantidad Pagada ($)</label>
                    <input type="text" id="cerrar-pagado-dolares" name="pagado_dolares" placeholder="000.00" inputmode="decimal" style="text-align: right; direction: rtl;">
                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 5px;">Formato autom치tico de derecha a izquierda</small>
                </div>
            </div>

            <div class="info-box">
                <p><strong>Nota:</strong> Los campos de cantidad pagada se calcular치n autom치ticamente seg칰n los m칠todos y entidades seleccionados, pero puedes ajustarlos manualmente si es necesario.</p>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-cerrar">Cancelar</button>
                <button type="submit" class="btn btn-primary">Cerrar Transacci칩n</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para ver detalles de transacci칩n -->
<div id="ver-transaccion-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="ver-transaccion-titulo">Detalles de la Transacci칩n</h3>
            <button class="modal-close" id="close-ver-transaccion-modal">&times;</button>
        </div>
        <div id="ver-transaccion-contenido" style="padding: 20px; max-height: 70vh; overflow-y: auto;">
            <!-- El contenido se llenar치 din치micamente -->
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cerrar-ver-transaccion">Cerrar</button>
        </div>
    </div>
</div>

<!-- Modal para nuevo cliente desde transacciones -->
<div id="nuevo-cliente-transaccion-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Nuevo Cliente</h3>
            <button class="modal-close" id="close-nuevo-cliente-modal">&times;</button>
        </div>
        <form id="nuevo-cliente-transaccion-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="nuevo-cliente-nombre">Nombre *</label>
                    <input type="text" id="nuevo-cliente-nombre" name="nombre" required>
                </div>
                <div class="form-group">
                    <label for="nuevo-cliente-apellido">Apellido *</label>
                    <input type="text" id="nuevo-cliente-apellido" name="apellido" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nuevo-cliente-tipo-cedula">Tipo de C칠dula *</label>
                    <select id="nuevo-cliente-tipo-cedula" name="tipo_cedula" required>
                        <option value="V">V - Venezolano</option>
                        <option value="E">E - Extranjero</option>
                        <option value="G">G - Gubernamental</option>
                        <option value="J">J - Jur칤dico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nuevo-cliente-cedula">C칠dula *</label>
                    <input type="number" id="nuevo-cliente-cedula" name="cedula" required min="0">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nuevo-cliente-telefono">Tel칠fono</label>
                    <input type="text" id="nuevo-cliente-telefono" name="telefono" placeholder="Opcional">
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-nuevo-cliente">Cancelar</button>
                <button type="submit" class="btn btn-primary">Guardar Cliente</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de confirmaci칩n para eliminar -->
<div id="delete-modal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h3>Confirmar Eliminaci칩n</h3>
            <button class="modal-close" id="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p>쮼st치s seguro de que deseas eliminar esta transacci칩n?</p>
            <p class="warning-text">Esta acci칩n no se puede deshacer.</p>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancel-delete">Cancelar</button>
            <button type="button" class="btn btn-danger" id="confirm-delete">Eliminar</button>
        </div>
    </div>
</div>

