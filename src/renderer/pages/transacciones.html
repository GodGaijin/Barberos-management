<div class="page-header">
    <h2>Transacciones</h2>
    <button id="btn-nueva-transaccion" class="btn btn-primary">+ Nueva Transacción</button>
</div>

<div class="page-content">
    <!-- Barra de búsqueda y filtros -->
    <div class="search-bar">
        <input type="text" id="search-transaccion" placeholder="Buscar por cliente..." class="search-input">
        <select id="filter-estado" class="filter-select">
            <option value="all">Todas las transacciones</option>
            <option value="abierta">Abiertas</option>
            <option value="cerrada">Cerradas</option>
        </select>
    </div>

    <!-- Tabla de transacciones -->
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Cliente</th>
                    <th>Fecha Apertura</th>
                    <th>Fecha Cierre</th>
                    <th>Total (Bs)</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="transacciones-table-body">
                <tr>
                    <td colspan="7" class="loading">Cargando transacciones...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para nueva transacción -->
<div id="transaccion-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="modal-title">Nueva Transacción</h3>
            <button class="modal-close" id="close-modal">&times;</button>
        </div>
        <form id="transaccion-form">
            <input type="hidden" id="transaccion-id">
            
            <div class="form-row">
                <div class="form-group">
                    <label for="transaccion-cliente">Cliente *</label>
                    <select id="transaccion-cliente" name="id_cliente" required>
                        <option value="">Seleccione un cliente...</option>
                    </select>
                </div>
            </div>

            <!-- Servicios -->
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="margin: 0;">Servicios</label>
                    <button type="button" id="btn-agregar-servicio" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">+ Agregar Servicio</button>
                </div>
                <div id="servicios-lista" style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Los servicios se agregarán aquí dinámicamente -->
                </div>
            </div>

            <!-- Productos -->
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="margin: 0;">Productos</label>
                    <button type="button" id="btn-agregar-producto" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">+ Agregar Producto</button>
                </div>
                <div id="productos-lista" style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Los productos se agregarán aquí dinámicamente -->
                </div>
            </div>

            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label for="transaccion-total-general">Total General (Bs)</label>
                    <input type="text" id="transaccion-total-general" name="total_general" placeholder="0.00" inputmode="decimal" readonly style="font-size: 18px; font-weight: 600;">
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-transaccion">Cancelar</button>
                <button type="button" class="btn btn-primary" id="guardar-transaccion">Guardar Transacción</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para cerrar transacción -->
<div id="cerrar-transaccion-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Cerrar Transacción</h3>
            <button class="modal-close" id="close-cerrar-modal">&times;</button>
        </div>
        <form id="cerrar-transaccion-form">
            <input type="hidden" id="cerrar-transaccion-id">
            
            <div class="form-group">
                <label>Resumen de la Transacción</label>
                <div id="resumen-transaccion" style="background: var(--bg-secondary); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                    <!-- Resumen se llenará dinámicamente -->
                </div>
            </div>

            <div class="form-group">
                <label>Métodos de Pago *</label>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="metodo_pago" value="efectivo" class="metodo-pago-checkbox">
                        <span>Efectivo</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="metodo_pago" value="efectivo_divisa" class="metodo-pago-checkbox">
                        <span>Efectivo en Divisa</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="metodo_pago" value="transferencia" class="metodo-pago-checkbox" data-requiere-entidad="true">
                        <span>Transferencia</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="metodo_pago" value="divisa" class="metodo-pago-checkbox" data-requiere-entidad="true">
                        <span>Divisa</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="metodo_pago" value="punto_venta" class="metodo-pago-checkbox" data-requiere-entidad="true">
                        <span>Punto de Venta</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="metodo_pago" value="pago_movil" class="metodo-pago-checkbox" data-requiere-entidad="true">
                        <span>Pago Móvil</span>
                    </label>
                </div>
            </div>

            <div class="form-group" id="entidades-group" style="display: none;">
                <label>Entidades de Pago *</label>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="entidad_pago" value="Banco Nacional de Credito" class="entidad-pago-checkbox">
                        <span>Banco Nacional de Crédito</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="entidad_pago" value="Banesco" class="entidad-pago-checkbox">
                        <span>Banesco</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="entidad_pago" value="Binance" class="entidad-pago-checkbox">
                        <span>Binance</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="entidad_pago" value="Banco de Venezuela" class="entidad-pago-checkbox">
                        <span>Banco de Venezuela</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" name="entidad_pago" value="Zelle" class="entidad-pago-checkbox">
                        <span>Zelle</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="numero-referencia">Número(s) de Referencia</label>
                <input type="text" id="numero-referencia" name="numero_referencia" placeholder="Ej: 123456, 789012 (separados por coma)">
                <small style="color: var(--text-secondary); font-size: 12px; margin-top: 5px; display: block;">Si hay múltiples referencias, sepáralas por coma</small>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-cerrar">Cancelar</button>
                <button type="submit" class="btn btn-primary">Cerrar Transacción</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div id="delete-modal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h3>Confirmar Eliminación</h3>
            <button class="modal-close" id="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p>¿Estás seguro de que deseas eliminar esta transacción?</p>
            <p class="warning-text">Esta acción no se puede deshacer.</p>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancel-delete">Cancelar</button>
            <button type="button" class="btn btn-danger" id="confirm-delete">Eliminar</button>
        </div>
    </div>
</div>

